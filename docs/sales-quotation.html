<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiệm gốm Inari - Báo giá</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .logo {
            width: 100px;
            height: auto;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .store-name {
            color: #d32f2f;
            font-size: 2.5em;
            font-weight: bold;
        }

        .info-section {
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .info-section div {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-label {
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #333;
            padding: 12px;
            text-align: center;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
            font-size: 1.1em;
        }

        .product-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
        }

        .total-row {
            text-align: right;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3e0;
        }

        .final-total {
            text-align: right;
            font-size: 1.5em;
            font-weight: bold;
            color: #d32f2f;
            margin-top: 10px;
            padding: 15px;
            background-color: #ffebee;
        }

        .stt-col { width: 8%; }
        .image-col { width: 20%; }
        .quantity-col { width: 12%; }
        .unit-col { width: 15%; }
        .price-col { width: 15%; }
        .total-col { width: 20%; }
    </style>
    <script>
        // Parse URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                address: params.get('address') || '',
                phone: params.get('phone') || '',
                bank_info: params.get('bank_info') || '',
                sub_total: params.get('sub_total') || '',
                grand_total: params.get('grand_total') || '',
                items: params.get('items') || ''
            };
        }

        // Parse items from JSON string
        function parseItems(itemsJson) {
            if (!itemsJson) return [];
            try {
                return JSON.parse(decodeURIComponent(itemsJson));
            } catch (e) {
                console.error('Error parsing items:', e);
                return [];
            }
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount);
        }

        // Populate the page with data
        function populateData() {
            const params = getUrlParams();

            // Update contact information
            document.getElementById('address').textContent = params.address;
            document.getElementById('phone').textContent = params.phone;
            document.getElementById('bank_info').textContent = params.bank_info;

            // Parse and populate items
            const items = parseItems(params.items);
            const tbody = document.getElementById('items-tbody');

            if (items.length > 0) {
                tbody.innerHTML = ''; // Clear existing rows

                let calculatedTotal = 0;

                items.forEach((item, index) => {
                    const row = document.createElement('tr');
                    const lineTotal = item.line_total || (item.quantity * item.unit_price);
                    calculatedTotal += lineTotal;

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><img src="${item.image_url || ''}" alt="${item.name || ''}" class="product-image" onerror="this.style.display='none'"></td>
                        <td>${item.quantity || 1}</td>
                        <td>${item.unit || ''}</td>
                        <td>${formatCurrency(item.unit_price || 0)} đ</td>
                        <td>${formatCurrency(lineTotal)} đ</td>
                    `;

                    tbody.appendChild(row);
                });

                // Update totals
                const subTotal = params.sub_total || calculatedTotal;
                const grandTotal = params.grand_total || subTotal;

                document.getElementById('sub_total').textContent = `${formatCurrency(subTotal)} đ`;
                document.getElementById('grand_total').textContent = `${formatCurrency(grandTotal)} đ`;
            } else if (params.sub_total && params.grand_total) {
                // If no items but totals provided, just update totals
                document.getElementById('sub_total').textContent = `${formatCurrency(params.sub_total)} đ`;
                document.getElementById('grand_total').textContent = `${formatCurrency(params.grand_total)} đ`;
            }
        }

        // Run on page load
        window.addEventListener('DOMContentLoaded', populateData);
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.svg" alt="Tiệm gốm Inari Logo" class="logo">
            <h1 class="store-name">Tiệm gốm Inari</h1>
        </div>

        <div class="info-section">
            <div><span class="info-label">Địa chỉ:</span> <span id="address"></span></div>
            <div><span class="info-label">Số điện thoại:</span> <span id="phone"></span></div>
            <div><span class="info-label">Thông tin tài khoản:</span> <span id="bank_info"></span></div>
        </div>

        <table>
            <thead>
                <tr>
                    <th class="stt-col">STT</th>
                    <th class="image-col">Hình ảnh</th>
                    <th class="quantity-col">Số lượng</th>
                    <th class="unit-col">Đơn vị</th>
                    <th class="price-col">Giá</th>
                    <th class="total-col">Tổng</th>
                </tr>
            </thead>
            <tbody id="items-tbody">
            </tbody>
        </table>

        <div class="total-row">
            <span id="sub_total"></span>
        </div>

        <div class="final-total">
            Tổng + Ship (Free) &nbsp;&nbsp; <span id="grand_total"></span>
        </div>
    </div>
</body>
</html>
